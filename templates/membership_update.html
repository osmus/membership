{% extends "layout.html" %}
{% block content %}
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul class="flashes">
{% for message in messages %}
    <li>{{ message }}</li>
{% endfor %}
</ul>
{% endif %}
{% endwith %}

{% from "_formhelpers.html" import render_field %}

<h2>Profile Information</h2>
<form method="post" action="{{ url_for('membership_update', token=token) }}">
    <dl>
        {{ form.csrf_token }}
        {{ render_field(form.first_name) }}
        {{ render_field(form.last_name) }}
        {{ render_field(form.email) }}
        {{ render_field(form.osm_username) }}
        {{ render_field(form.address1) }}
        {{ render_field(form.address2) }}
        {{ render_field(form.city) }}
        {{ render_field(form.region) }}
        {{ render_field(form.postal_code) }}
        {{ render_field(form.country) }}
        {{ render_field(form.phone) }}
    </dl>
    <p><input type="submit" value="Update Your Information">
</form>

<h2>Payment Information</h2>

<p>We're using a <strong>{{ current_payment.brand }}</strong> ending in <strong>{{ current_payment.last4 }}</strong>. If you'd like to update it, click the button below:</p>

<form method="post" action="{{ url_for('membership_payment_update', token=token) }}">
    <script
        src="https://checkout.stripe.com/checkout.js" class="stripe-button"
        data-key="{{ stripe_key }}"
        data-name="OpenStreetMap US"
        data-panel-label="Update Card Details"
        data-label="Update Card Details"
        data-email="{{ customer_email }}"
        data-allow-remember-me=false
        data-locale="auto">
    </script>
</form>

{% endblock %}
